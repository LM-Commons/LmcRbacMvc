"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[246],{2712:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var r=n(4848),s=n(8453);const i={title:"Strategies",sidebar_position:3},a=void 0,c={id:"strategies",title:"Strategies",description:"What are strategies?",source:"@site/docs/strategies.md",sourceDirName:".",slug:"/strategies",permalink:"/LmcRbacMvc/docs/next/strategies",draft:!1,unlisted:!1,editUrl:"https://github.com/lm-commons/lmcrbacmvc/tree/master/docs/docs/strategies.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Strategies",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Guards",permalink:"/LmcRbacMvc/docs/next/guards"},next:{title:"Authorization Service",permalink:"/LmcRbacMvc/docs/next/using-the-authorization-service"}},o={},l=[{value:"What are strategies?",id:"what-are-strategies",level:2},{value:"Built-in strategies",id:"built-in-strategies",level:2},{value:"RedirectStrategy",id:"redirectstrategy",level:3},{value:"UnauthorizedStrategy",id:"unauthorizedstrategy",level:3},{value:"Creating custom strategies",id:"creating-custom-strategies",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"what-are-strategies",children:"What are strategies?"}),"\n",(0,r.jsxs)(t.p,{children:["A strategy is an object that listens to the ",(0,r.jsx)(t.code,{children:"MvcEvent::EVENT_DISPATCH_ERROR"})," event. It is used to describe what\nhappens when access to a resource is unauthorized by LmcRbacMvc."]}),"\n",(0,r.jsxs)(t.p,{children:["LmcRbacMvc strategies all check if an ",(0,r.jsx)(t.code,{children:"Lmc\\Rbac\\Mvc\\Exception\\UnauthorizedExceptionInterface"})," has been thrown."]}),"\n",(0,r.jsxs)(t.p,{children:["By default, LmcRbacMvc does not register any strategy for you. The best place to register it in a config file under the\n",(0,r.jsx)(t.code,{children:"'listeners'"})," key:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    // other configs...\n    \n    'listeners' => [\n        \\Lmc\\Rbac\\Mvc\\View\\Strategy\\UnauthorizedStrategy::class\n    ],\n];\n"})}),"\n",(0,r.jsx)(t.h2,{id:"built-in-strategies",children:"Built-in strategies"}),"\n",(0,r.jsx)(t.p,{children:"LmcRbacMvc comes with two built-in strategies:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"\\Lmc\\Rbac\\Mvc\\View\\Strategy\\RedirectStrategy"})}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"\\Lmc\\Rbac\\Mvc\\View\\Strategy\\UnauthorizedStrategy"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"redirectstrategy",children:"RedirectStrategy"}),"\n",(0,r.jsx)(t.p,{children:"This strategy allows your application to redirect any unauthorized request to another route by optionally appending the previous\nURL as a query parameter."}),"\n",(0,r.jsx)(t.p,{children:"To register it, copy-paste this code into a configuration file:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    // other configs...\n    \n    'listeners' => [\n        \\Lmc\\Rbac\\Mvc\\View\\Strategy\\RedirectStrategy::class\n    ],\n];\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You can configure the strategy using the ",(0,r.jsx)(t.code,{children:"redirect_strategy"})," subkey:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    'lmc_rbac' => [\n        'redirect_strategy' => [\n            'redirect_when_connected'        => true,\n            'redirect_to_route_connected'    => 'home',\n            'redirect_to_route_disconnected' => 'login',\n            'append_previous_uri'            => true,\n            'previous_uri_query_key'         => 'redirectTo'\n        ],\n    ]\n];\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If users try to access an unauthorized resource (eg.: ",(0,r.jsx)(t.a,{href:"http://www.example.com/delete",children:"http://www.example.com/delete"}),'), they will be\nredirected to the "login" route if is not connected and to the "home" route otherwise with the previous URL appended:']}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"http://www.example.com/login?redirectTo=http://www.example.com/delete",children:"http://www.example.com/login?redirectTo=http://www.example.com/delete"})}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["You can prevent redirection when a user is connected (i.e. so that the user gets a 403 page) by setting ",(0,r.jsx)(t.code,{children:"redirect_when_connected"})," to ",(0,r.jsx)(t.code,{children:"false"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"unauthorizedstrategy",children:"UnauthorizedStrategy"}),"\n",(0,r.jsx)(t.p,{children:"This strategy allows your application to render a template on any unauthorized request."}),"\n",(0,r.jsx)(t.p,{children:"To register it, copy-paste this code into your Module.php class:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    // other configs...\n    \n    'listeners' => [\n        \\Lmc\\Rbac\\Mvc\\View\\Strategy\\UnauthorizedStrategy::class\n    ],\n];\n"})}),"\n",(0,r.jsxs)(t.p,{children:["You can configure the strategy using the ",(0,r.jsx)(t.code,{children:"unauthorized_strategy"})," subkey:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    'lmc_rbac' => [\n        'unauthorized_strategy' => [\n            'template' => 'error/custom-403'\n        ],\n    ]\n];\n"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["By default, LmcRbacMvc uses a template called ",(0,r.jsx)(t.code,{children:"error/403"}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"creating-custom-strategies",children:"Creating custom strategies"}),"\n",(0,r.jsxs)(t.p,{children:["Creating a custom strategy is rather easy. Let's say we want to create a strategy that integrates with\nthe ",(0,r.jsx)(t.a,{href:"https://github.com/laminas-api-tools/api-tools-api-problem",children:"ApiProblem"})," Laminas Api Tools module:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"namespace Application\\View\\Strategy;\n\nuse Laminas\\Http\\Response as HttpResponse;\nuse Laminas\\Mvc\\MvcEvent;\nuse Laminas\\ApiTools\\ApiProblem\\ApiProblem;\nuse Laminas\\ApiTools\\ApiProblem\\ApiProblemResponse;\nuse Lmc\\Rbac\\Mvc\\View\\Strategy\\AbstractStrategy;\nuse Lmc\\Rbac\\Mvc\\Exception\\UnauthorizedExceptionInterface;\n\nclass ApiProblemStrategy extends AbstractStrategy\n{\n    public function onError(MvcEvent $event)\n    {\n        // Do nothing if no error or if response is not HTTP response\n        if (!($exception = $event->getParam('exception') instanceof UnauthorizedExceptionInterface)\n            || ($result = $event->getResult() instanceof HttpResponse)\n            || !($response = $event->getResponse() instanceof HttpResponse)\n        ) {\n            return;\n        }\n\n        return new ApiProblemResponse(new ApiProblem($exception->getMessage()));\n    }\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Register your strategy:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"return [\n    // other configs...\n    \n    'listeners' => [\n        Application\\View\\Strategy\\ApiProblemStrategy::class,\n    ],\n];\n"})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>c});var r=n(6540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);