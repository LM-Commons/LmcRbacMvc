"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3976],{619:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var i=t(4848),c=t(8453);const r={title:"Getting Started",sidebar_label:"Getting Started",sidebar_position:1},o=void 0,a={id:"intro",title:"Getting Started",description:"LmcRbacMvc is a companion component that extends the functionality of LmcRbac to provide Role-based Access Control",source:"@site/docs/intro.md",sourceDirName:".",slug:"/intro",permalink:"/LmcRbacMvc/docs/next/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/lm-commons/lmcrbacmvc/tree/master/docs/docs/intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Getting Started",sidebar_label:"Getting Started",sidebar_position:1},sidebar:"tutorialSidebar",next:{title:"Guards",permalink:"/LmcRbacMvc/docs/next/guards"}},s={},d=[{value:"Extending LmcRbac",id:"extending-lmcrbac",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Optional requirements",id:"optional-requirements",level:3},{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Specifying an identity provider",id:"specifying-an-identity-provider",level:3},{value:"Adding a guard",id:"adding-a-guard",level:2},{value:"Registering a strategy",id:"registering-a-strategy",level:2},{value:"Using the authorization service",id:"using-the-authorization-service",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"LmcRbacMvc is a companion component that extends the functionality of LmcRbac to provide Role-based Access Control\n(RBAC) for Laminas MVC applications."}),"\n",(0,i.jsx)(n.p,{children:"LmcRbacMvc provides additional features on top of LmcRbac that are suitable for a Laminas MVC application:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Guards that acts like a firewall allowing access to routes, controllers and actions to authorized users."}),"\n",(0,i.jsx)(n.li,{children:"Strategies to execute when unauthorized access occurs such as redirection and error responses"}),"\n",(0,i.jsx)(n.li,{children:"Extensions to LmcRbac Authorization service such as controller and view plugins"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Important Note:",type:"tip",children:(0,i.jsxs)(n.p,{children:["If you are migrating from v3, there are breaking changes to take into account. See the ",(0,i.jsx)(n.a,{href:"/LmcRbacMvc/docs/next/Upgrading/upgrade",children:"Upgrading"})," section for details."]})}),"\n",(0,i.jsx)(n.h2,{id:"extending-lmcrbac",children:"Extending LmcRbac"}),"\n",(0,i.jsx)(n.p,{children:"LmcRbacMvc extends the functionality of LmcRbac to support Laminas MVC applications."}),"\n",(0,i.jsx)(n.p,{children:"It is highly recommended to first go through the concepts and usage of LmcRbac before using the functionalities of\nLmcRbacMvc."}),"\n",(0,i.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PHP 8.1 or higher"}),"\n",(0,i.jsx)(n.li,{children:"LmcRbac v2 (installed by default)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"optional-requirements",children:"Optional requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/LM-Commons/LmcRbacMvcDeveloperTools",children:"LmcRbacMvcDeveloperTools"}),": a companion component to Laminas Developer Tools to collect and display LmcRbcMvc data"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Install the module using Composer:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ composer require lm-commons/lmc-rbac-mvc:^4.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You will be prompted by the ",(0,i.jsx)(n.code,{children:"laminas-component-installer"})," plugin to inject LM-Commons\\LmcRbacMvc."]}),"\n",(0,i.jsx)(n.admonition,{title:"Manual installation",type:"note",children:(0,i.jsxs)(n.p,{children:["Enable the module by adding ",(0,i.jsx)(n.code,{children:"Lmc\\Rbac\\Mvc"})," key to your ",(0,i.jsx)(n.code,{children:"application.config.php"})," or ",(0,i.jsx)(n.code,{children:"modules.config.php"})," file."]})}),"\n",(0,i.jsxs)(n.p,{children:["Customize the module by copy-pasting the ",(0,i.jsx)(n.code,{children:"lmc_rbac.global.php.dist"})," file to your ",(0,i.jsx)(n.code,{children:"config/autoload"})," folder."]}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.p,{children:["LmcRbac and LmcRbacMvc share the same config key ",(0,i.jsx)(n.code,{children:"'lmc_rbac'"}),". Be careful when creating configuration files to avoid\noverriding configuration."]}),(0,i.jsx)(n.p,{children:"It is recommended that have one configuration file containing both LmcRbac and LmcRbacMvc configuration. This makes it\neasier to keep all configuration in one place."})]}),"\n",(0,i.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsxs)(n.p,{children:["Before you start configuring LmcRbacMvc, you must set up LmcRbac first. Please follow the ",(0,i.jsx)(n.a,{href:"https://lm-commons.github.io/LmcRbac/docs/gettingstarted",children:"instructions"})," in LmcRbac\ndocumentation."]}),"\n",(0,i.jsx)(n.h3,{id:"specifying-an-identity-provider",children:"Specifying an identity provider"}),"\n",(0,i.jsxs)(n.p,{children:["By default, LmcRbacMvc internally uses the ",(0,i.jsx)(n.code,{children:"Laminas\\Authentication\\AuthenticationService"})," service key to retrieve the user (logged or\nnot). Therefore, you must implement and register this service in your application by providing a factory on your configuration."]}),"\n",(0,i.jsxs)(n.p,{children:["For example, in ",(0,i.jsx)(n.code,{children:"module.config.php"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"return [\n    'service_manager' => [\n        'factories' => [\n\t        \\Laminas\\Authentication\\AuthenticationService::class => function($container) {\n\t            // Create your authentication service!\n\t        }\n\t    ]\n    ]\n];\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The identity given by ",(0,i.jsx)(n.code,{children:"Laminas\\Authentication\\AuthenticationService"})," must implement ",(0,i.jsx)(n.code,{children:"Lmc\\Rbac\\Identity\\IdentityInterface"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Note that the default identity provided with Laminas does not implement this interface."})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsxs)(n.p,{children:["If you are also using the ",(0,i.jsx)(n.a,{href:"https://github.com/lm-commons/lmcuser",children:"LmcUser"})," package, then the ",(0,i.jsx)(n.code,{children:"Laminas\\Authentication\\AuthenticationService"})," will be\nprovided for you and there is no need to implement your own."]}),(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["LmcUser's default User entity does not implement the ",(0,i.jsx)(n.code,{children:"IdentityInteface"})," that is required\nby LmcRbac."]})})]}),"\n",(0,i.jsxs)(n.p,{children:["LmcRbacMvc is flexible enough to use something other than the built-in ",(0,i.jsx)(n.code,{children:"AuthenticationService"}),", by specifying custom\nidentity providers. For more information, refer to the ",(0,i.jsx)(n.a,{href:"/LmcRbacMvc/docs/next/Guides/identity-providers",children:"Create a custom identity provider"}),"\nsection."]}),"\n",(0,i.jsx)(n.h2,{id:"adding-a-guard",children:"Adding a guard"}),"\n",(0,i.jsxs)(n.p,{children:["A guard allows your application to block access to routes and/or controllers using a simple syntax. For instance, this configuration\ngrants access to any route that begins with ",(0,i.jsx)(n.code,{children:"admin"})," (or is exactly ",(0,i.jsx)(n.code,{children:"admin"}),") to the ",(0,i.jsx)(n.code,{children:"admin"})," role only:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"return [\n    'lmc_rbac' => [\n        'guards' => [\n\t        'Lmc\\Rbac\\Mvc\\Guard\\RouteGuard' => [\n                'admin*' => ['admin']\n\t        ]\n        ]\n    ]\n];\n"})}),"\n",(0,i.jsxs)(n.p,{children:["LmcRbacMvc has several built-in guards, and you can also register your own guards. For more information, refer\n",(0,i.jsx)(n.a,{href:"/LmcRbacMvc/docs/next/guards#built-in-guards",children:"to this section"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"registering-a-strategy",children:"Registering a strategy"}),"\n",(0,i.jsxs)(n.p,{children:["When a guard blocks access to a route/controller, or if you throw the ",(0,i.jsx)(n.code,{children:"Lmc\\Rbac\\Mvc\\Exception\\UnauthorizedException"}),"\nexception in your service, LmcRbacMvc automatically performs some logic for you depending on the view strategy used."]}),"\n",(0,i.jsxs)(n.p,{children:['For instance, if you want LmcRbacMvc to automatically redirect all unauthorized requests to the "login" route,\nadd\nthe following code in the ',(0,i.jsx)(n.code,{children:"onBootstrap"})," method of your ",(0,i.jsx)(n.code,{children:"Module.php"})," class:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function onBootstrap(MvcEvent $event)\n{\n    $app = $event->getApplication();\n    $sm = $app->getServiceManager();\n    $em = $app->getEventManager();\n    \n    $listener = $sm->get(\\Lmc\\Rbac\\Mvc\\View\\Strategy\\RedirectStrategy::class);\n    $listener->attach($em);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"or add the listener to 'listeners' config key in a configuration file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"return [\n    // other configs...\n    \n    'listeners' => [\n        \\Lmc\\Rbac\\Mvc\\View\\Strategy\\RedirectStrategy::class\n    ],\n];\n"})}),"\n",(0,i.jsxs)(n.p,{children:["By default, ",(0,i.jsx)(n.code,{children:"RedirectStrategy"}),' redirects all unauthorized requests to a route named "login" when the user is not connected\nand to a route named "home" when the user is connected. This is entirely configurable.']}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["For flexibility purposes, LmcRbacMvc ",(0,i.jsx)(n.strong,{children:"does not"})," register any strategy for you by default!"]})}),"\n",(0,i.jsxs)(n.p,{children:["For more information about built-in strategies, refer ",(0,i.jsx)(n.a,{href:"/LmcRbacMvc/docs/next/strategies#built-in-strategies",children:"to this section"}),"\nin the ",(0,i.jsx)(n.a,{href:"/LmcRbacMvc/docs/next/strategies",children:"Strategies"})," section."]}),"\n",(0,i.jsx)(n.h2,{id:"using-the-authorization-service",children:"Using the authorization service"}),"\n",(0,i.jsx)(n.p,{children:"With LmcRbac and LmcRbacMvc properly configured, you can inject the authorization service into any class and use it to\ncheck if the current identity is granted to do something."}),"\n",(0,i.jsx)(n.p,{children:"The LmcRbacMvc Authorization Service is a wrapper to the LmcRbac Authorization Service."}),"\n",(0,i.jsxs)(n.p,{children:["The difference is in the ",(0,i.jsx)(n.code,{children:"isGranted"})," method:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"public function isGranted(string $permission, mixed $context = null): bool;\n"})}),"\n",(0,i.jsx)(n.p,{children:"where the service will get the identity from the identity provider and there is no need to get it separately."}),"\n",(0,i.jsxs)(n.p,{children:["The authorization service can be retrieved from the container using the key ",(0,i.jsx)(n.code,{children:"Lmc\\Rbac\\Mvc\\Service\\AuthorizationServiceInterface"}),".\nOnce injected, you can use it as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"use Lmc\\Rbac\\Mvc\\Exception\\UnauthorizedException;\n\nclass ActionController extends  \\Laminas\\Mvc\\Controller\\AbstractActionController {\npublic function delete()\n{\n    if (!$this->authorizationService->isGranted('delete')) {\n        throw new UnauthorizedException();\n    }\n\n    // Delete the post\n}\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(6540);const c={},r=i.createContext(c);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);