"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[430],{2164:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>l,frontMatter:()=>i,metadata:()=>a,toc:()=>u});var s=t(4848),r=t(8453);const i={title:"Using LmcRbacMvc and LmcUser",sidebar_label:"Using LmcRbacMvc and LmcUser",sidebar_position:3},c=void 0,a={id:"Guides/lmcuser",title:"Using LmcRbacMvc and LmcUser",description:"To use the authentication service from LmcUser, there are a few actions to take:",source:"@site/docs/Guides/lmcuser.md",sourceDirName:"Guides",slug:"/Guides/lmcuser",permalink:"/LmcRbacMvc/docs/next/Guides/lmcuser",draft:!1,unlisted:!1,editUrl:"https://github.com/lm-commons/lmcrbacmvc/tree/master/docs/docs/Guides/lmcuser.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Using LmcRbacMvc and LmcUser",sidebar_label:"Using LmcRbacMvc and LmcUser",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Custom Identity Providers",permalink:"/LmcRbacMvc/docs/next/Guides/identity-providers"},next:{title:"Debugging Tools",permalink:"/LmcRbacMvc/docs/next/Guides/debugging"}},o={},u=[{value:"Set up the user entity",id:"set-up-the-user-entity",level:2},{value:"Set up the Laminas authentication service to use LmcUser",id:"set-up-the-laminas-authentication-service-to-use-lmcuser",level:2},{value:"Set up guards",id:"set-up-guards",level:2},{value:"Set up a redirect strategy",id:"set-up-a-redirect-strategy",level:2}];function d(e){const n={admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"To use the authentication service from LmcUser, there are a few actions to take:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Set up a user entity that supports roles"}),"\n",(0,s.jsx)(n.li,{children:"Set up the Laminas authentication service to use LmcUser"}),"\n",(0,s.jsx)(n.li,{children:"Set up guards"}),"\n",(0,s.jsx)(n.li,{children:"Optionally, set up a redirect strategy"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-the-user-entity",children:"Set up the user entity"}),"\n",(0,s.jsxs)(n.p,{children:["The default user entity class in LmcUser does not implement the ",(0,s.jsx)(n.code,{children:"Lmc\\Rbac\\Identity\\IdentityInterface"}),". You will need\nto define a user identity class that does by, for example, extending the default user class:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n\nclass CustomUser extends \\LmcUser\\Entity\\User implements \\Lmc\\Rbac\\Identity\\IdentityInterface\n{\n    private array $roles = ['user'];  // let's make 'user' the default role\n\n    public function getRoles(): array\n    {\n        return $this->roles;\n    }\n\n    public function setRoles(array $roles): User\n    {\n        $this->roles = $roles;\n        return $this;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"and then set LmcUser to use this entity:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"return [\n    'lmc_user' => [\n        'user_entity_class' => CustomUser::class,\n    ]\n];\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"This example does not cover modifying the database tables and mappers to fetch/hydrate roles into the user object."})}),"\n",(0,s.jsx)(n.h2,{id:"set-up-the-laminas-authentication-service-to-use-lmcuser",children:"Set up the Laminas authentication service to use LmcUser"}),"\n",(0,s.jsx)(n.p,{children:"You need to set up Laminas Authentication to use the Authentication service from LmcUser."}),"\n",(0,s.jsxs)(n.p,{children:["Add the following alias in your ",(0,s.jsx)(n.code,{children:"application.config.php"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"return [\n    'service_manager' => [\n        'aliases' => [\n            'Laminas\\Authentication\\AuthenticationService' => 'lmcuser_auth_service'\n        ]\n    ]\n];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"set-up-guards",children:"Set up guards"}),"\n",(0,s.jsx)(n.p,{children:"The login and register pages should be only accessible from 'guest' users and all other pages should be accessible from\nlogged in users."}),"\n",(0,s.jsxs)(n.p,{children:["Add the LmcUser routes to your ",(0,s.jsx)(n.code,{children:"guards"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"return [\n    'lmc_rbac' => [\n        'guards' => [\n            \\Lmc\\Rbac\\Mvc\\Guard\\RouteGuard::class => [\n                'lmcuser/login'    => ['guest'],\n                'lmcuser/register' => ['guest'], // required if registration is enabled\n                'lmcuser*'         => ['user'] // includes logout, changepassword and changeemail\n            ]\n        ]\n    ]\n];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"set-up-a-redirect-strategy",children:"Set up a redirect strategy"}),"\n",(0,s.jsxs)(n.p,{children:["If you would like for your application to redirect users to the login page when an unauthorized access is detected, then\nyou need to setup the ",(0,s.jsx)(n.code,{children:"RedirectStrategy"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"In your application.config.php:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"\nreturn [\n    'listeners' => [\n        \\Lmc\\Rbac\\Mvc\\View\\Strategy\\RedirectStrategy::class,\n    ],\n];\n"})}),"\n",(0,s.jsx)(n.p,{children:"In your LmcRbac config file"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"return [\n    'lmc_rbac' => [\n        'redirect_strategy' => [\n            'redirect_when_connected'        => true,\n            'redirect_to_route_connected'    => 'home',\n            'redirect_to_route_disconnected' => 'lmcuser/login',\n            'append_previous_uri'            => true,\n            'previous_uri_query_key'         => 'redirectTo'\n        ],\n    ]\n];\n"})})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var s=t(6540);const r={},i=s.createContext(r);function c(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);